---
title: äº†è§£å’Œå¼€å‘ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶
date: '2024-10-21'
tags: ['browser', 'chrome', 'extension', 'webpack']
draft: false
summary: è®¤è¯†ä»€ä¹ˆæ˜¯æµè§ˆå™¨æ’ä»¶ä»¥åŠå¦‚ä½•å¼€å‘ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶ï¼Œå®ç°å„ç§åŠŸèƒ½...
---

å¦‚æœæ‚¨è¿˜æœªä½¿ç”¨è¿‡æµè§ˆå™¨æ’ä»¶ï¼Œå¯ä»¥æ‰“å¼€ [Chrome æµè§ˆå™¨æ’ä»¶å•†åº—](https://chromewebstore.google.com) çœ‹çœ‹

![Chrome æµè§ˆå™¨æ’ä»¶å•†åº—](/static/images/mdx/extension/store.png)

å’Œä»¥å¾€æ‰€è§åˆ°çš„æ’ä»¶ç³»ç»Ÿçš„å®šä¹‰ç›¸åŒï¼Œæµè§ˆå™¨æ’ä»¶ä¹Ÿæ˜¯ç”¨æ¥å¢å¼ºæµè§ˆå™¨çš„åŠŸèƒ½ï¼Œæ­£å¦‚ä¸Šå›¾ä¸­çš„å‰¯æ ‡é¢˜ï¼šâ€œè®©æµè§ˆå™¨å¦‚è™æ·»ç¿¼â€

è€Œæ ¹æ®å…·ä½“éœ€è¦å¯ä»¥é€‰æ‹©ä¸åŒçš„æ’ä»¶å¢å¼ºä¸åŒåŠŸèƒ½ï¼ŒåŒæ ·è§ä¸Šå›¾ä¸‹åŠéƒ¨åˆ†çš„â€œçƒ­é—¨åˆ†ç±»â€

ä¸å¦¨é€‰æ‹©ä¸‹è½½è¯•ç”¨ä¸‹å‡ ä¸ªæ’ä»¶ï¼ˆä»…ä¸¾ä¾‹ï¼Œå¯è‡ªç”±é€‰æ‹©è¯•ç”¨ï¼‰

1. [DeepLï¼šäººå·¥æ™ºèƒ½ç¿»è¯‘å™¨å’Œå†™ä½œåŠ©æ‰‹](https://chromewebstore.google.com/detail/deepl%EF%BC%9A%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%BF%BB%E8%AF%91%E5%99%A8%E5%92%8C%E5%86%99%E4%BD%9C%E5%8A%A9%E6%89%8B/cofdbpoegempjloogbagkncekinflcnj) åˆ’è¯ç¿»è¯‘ï¼Œæ— éœ€å†å¤åˆ¶åˆ°ç¿»è¯‘è½¯ä»¶ä¸­ç²˜è´´æŸ¥çœ‹è¯‘æ–‡
2. [Popup my Bookmarks](https://chromewebstore.google.com/detail/popup-my-bookmarks/mppflflkbbafeopeoeigkbbdjdbeifni) ä¹¦ç­¾ç®¡ç†ï¼Œä¸ªäººä¹ æƒ¯ä¸å±•ç¤ºæµè§ˆå™¨ä¹¦ç­¾æ ï¼Œç‚¹å‡»æ’ä»¶å›¾æ ‡å³å±•å¼€ä¹¦ç­¾
3. [Text Blaze: Templates and Snippets](https://chromewebstore.google.com/detail/text-blaze-templates-and/idgadaccgipmpannjkmfddolnnhmeklj) è¾“å…¥æ¡†è¡¥å…¨ï¼Œå¯ä»¥é¢„è®¾å¸¸ç”¨ç‰‡æ®µï¼Œæ¯”å¦‚é‚®ä»¶ã€è´¦å·ã€å¯†ç ç­‰ï¼Œæµè§ˆå™¨ä¸­çš„è¾“å…¥åœºæ™¯å°±å¯ä»¥ä¸€é”®è¡¥å…¨

è¿˜æœ‰å„ç§åœºæ™¯å¯ä»¥è§£é”ï¼Œç†Ÿç»ƒä½¿ç”¨å„ç§æ’ä»¶ç»å¯¹å¯ä»¥æå‡ä½ çš„å·¥ä½œå­¦ä¹ æ•ˆç‡

## æ’ä»¶éƒ½å¯ä»¥åšä»€ä¹ˆ

1. å¢å¼º Tab é¡µï¼Œæ–°å¢æˆ–åˆ é™¤å†…å®¹ï¼Œæ¯”å¦‚ [DeepL](https://chromewebstore.google.com/detail/deepl%EF%BC%9A%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%BF%BB%E8%AF%91%E5%99%A8%E5%92%8C%E5%86%99%E4%BD%9C%E5%8A%A9%E6%89%8B/cofdbpoegempjloogbagkncekinflcnj) å¯ä»¥åˆ’è¯å°±åœ°ç¿»è¯‘å±•ç¤ºï¼Œå¼¹å‡ºçª—å£å¹¶ä¸æ˜¯å½“å‰è®¿é—®é¡µé¢æ‰€æ„å»ºçš„ï¼Œè€Œæ˜¯ç”±æ’ä»¶åˆ›å»ºå¹¶æ’å…¥è¿›å½“å‰é¡µé¢çš„
2. å¢å¼ºè®¾ç½®æ“ä½œæŒ‰é’®ï¼Œæ¯ä¸ªæ’ä»¶éƒ½ä¼šå±•ç¤ºåœ¨å³ä¸Šéƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥è®¾ç½®å…¶æ”¶èµ·æˆ–å±•å¼€å±•ç¤ºæ’ä»¶å›¾æ ‡ï¼Œç‚¹å‡»å›¾æ ‡æ—¶ä¼šå±•ç¤ºæ’ä»¶æä¾›çš„ popup å¼¹å‡ºçª—å£ï¼Œæ¯”å¦‚ [å¤©æ°” - Weather](https://chromewebstore.google.com/detail/%E5%A4%A9%E6%B0%94-weather/ibieofighcnndjcjchdahdiacjpmkhgf) ç›´æ¥å›¾æ ‡å±•ç¤ºä»Šæ—¥å¤©æ°”ï¼Œç‚¹å‡»å±•å¼€å¼¹å‡ºçª—å£æŸ¥çœ‹æ›´å¤šä¿¡æ¯
3. å¢å¼ºå³é”®å·¥å…·æ ï¼Œè®¿é—®ä»»ä½•é¡µé¢éƒ½å¯ä»¥å³é”®æ“ä½œæµè§ˆå™¨ï¼Œå¯ä»¥åœ¨æ­¤æ–°å¢å¿«æ·æ“ä½œ
4. å¢å¼ºåœ°å€æ è¾“å…¥ï¼Œæ–°å¢å¿«æ·è®¿é—®ç­‰
5. å¢å¼ºæ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œå¯ä»¥æ›¿æ¢æµè§ˆå™¨æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œè‡ªå®šä¹‰ä»»ä½•å†…å®¹ï¼Œæ¯”å¦‚ [Clear New Tab](https://chromewebstore.google.com/detail/clear-new-tab/felphkbfjadmcejnibcmcncimlappdde) å¯ä»¥æ›¿æ¢é»˜è®¤æ–°æ ‡ç­¾é¡µï¼Œæ›¿æ¢ä¸ºä¸€ä¸ªç®€æ´çš„ç©ºç™½é¡µ
6. å¢å¼ºå¼€å‘è€…å·¥å…·ï¼Œæ¯”å¦‚ [Redux DevTools](https://chromewebstore.google.com/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd) å¯ä»¥æŸ¥çœ‹ Redux çŠ¶æ€æ ‘

## å¦‚ä½•å¼€å‘[^1]

[^1]: [æ¬¢è¿ä½¿ç”¨æ‰©å±•ç¨‹åºï¼](https://developer.chrome.com/docs/extensions)

é¦–å…ˆä¸€ä¸ªæ’ä»¶ç›®å½•åŒ…æ‹¬ [manifest.json](https://developer.chrome.com/docs/extensions/reference/manifest) é…ç½®æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€å°æ¸…å•å†…å®¹ï¼š

```json:manifest.json
{
  "manifest_version": 3,
  "name": "Extension Name",
  "description": "Extension Description",
  "version": "1.0.0"
}
```

### Popup å¼¹å‡ºçª—å£

åœ¨ manifest.json æ–°å¢ action é…ç½®ï¼Œå¹¶åœ¨æ’ä»¶ç›®å½•ä¸­æä¾› popup.htmlï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•å¸¸è§„çš„ HTML é¡µé¢

```json:manifest.json
{
  "action": {
    "default_popup": "popup.html"
  }
}
```

åœ¨ç‚¹å‡»å›¾æ ‡æ—¶å³å¯å¼¹å‡ºçª—å£å±•ç¤º popup.html å†…å®¹

![popup.html](/static/images/mdx/extension/popup.png)

### Service Worker åå°è„šæœ¬[^2]

[^2]: [æ‰©å±•ç¨‹åº Service Worker ç®€ä»‹](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers)

æœ¬æ–‡ä¸åšè¯¦ç»† API ä»‹ç»ï¼Œè¯¦æƒ…è¯·å‚è§[æ–‡æ¡£](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers)

è¯•æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘è¿›å…¥äº†ä¸€ä¸ªé˜…è¯»ç½‘ç«™ï¼Œä½†æˆ‘åªæƒ³åœ¨å½“å‰é¡µé¢é˜…è¯» 15 åˆ†é’Ÿï¼Œä¸æƒ³åœ¨æ­¤è€—è´¹å¤ªå¤šæ—¶é—´ï¼Œæˆ‘ç‚¹å¼€å³ä¸Šè§’çš„å®šæ—¶å™¨æ’ä»¶ï¼Œå¸Œæœ›åœ¨æ­¤é¡µé¢é˜…è¯»åœç•™ 15 åˆ†é’Ÿåé—¹é“ƒæç¤ºæˆ‘ã€‚
æ³¨æ„ä¸æ˜¯å®šæ—¶ 15 åˆ†é’Ÿï¼Œè€Œæ˜¯åœ¨å½“å‰é¡µé¢é˜…è¯»æ»¡ 15 åˆ†é’Ÿï¼Œä¸ç„¶ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨é—¹é’Ÿå‘¢ï¼ŸğŸ¤£

è¿™ç§åœºæ™¯ä¸‹æˆ‘ä»¬è€ƒè™‘ä¸‹å¦‚ä½•å®ç°ï¼Ÿé¦–å…ˆæ˜¯æ•´ä¸ªåº”ç”¨æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ˆå…¶ä»–éƒ¨åˆ†ä¸‹æ–‡å†ç»§ç»­è¡¥å……ï¼‰ï¼šå®šæ—¶å™¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ popup ä¸­å®ç°å¹¶ç»´æŠ¤å®šæ—¶å™¨ï¼Œä¸€æ—¦å…³é—­ popupï¼Œä¿å­˜åœ¨å†…å­˜ä¸­çš„å®šæ—¶å™¨ä¹Ÿä¼šéšç€ç¨‹åºçš„å…³é—­è€Œé”€æ¯ï¼Œé‡æ–°æ‰“å¼€æ—¶åˆæ˜¯ä¸€ä¸ªåˆå§‹åŒ–æµç¨‹ã€‚

è¿™æ—¶å°±éœ€è¦å€ŸåŠ©ä¸€ä¸ªå¯ä»¥æŒç»­è¿è¡Œçš„åå°è„šæœ¬ï¼Œå’Œ Web åº”ç”¨ä¸€æ ·ï¼Œæ’ä»¶ä¹Ÿæ”¯æŒæ³¨å†Œ Service Worker åå°è„šæœ¬

```json:manifest.json
{
  "background": {
    "service_worker": "sw.js"
  }
}
```

åœ¨ç›®å½•ä¸­æ–°å»º sw.js å¹¶å†™å…¥å†…å®¹

```js:sw.js
console.log("Service Worker Script")
setInterval(function () {
  console.log("log from service worker every 3s")
}, 3000)
```

ç„¶åæ‰“å¼€æ’ä»¶ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»åˆ·æ–°é‡è½½æ’ä»¶ï¼Œå°±å¯ä»¥çœ‹åˆ° â€œæ£€æŸ¥è§†å›¾ Service Workerâ€

![åŠ è½½ sw.js](/static/images/mdx/extension/sw-load.png)

ç‚¹å‡»ä¼šæ–°çª—å£æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå°±å¯ä»¥çœ‹åˆ° Service Worker è„šæœ¬çš„æ‰§è¡Œæ—¥å¿—ï¼Œ`setInterval` å¯ä»¥æ­£å¸¸æŒç»­æ‰§è¡Œ

![æŸ¥çœ‹ sw.js console ä¿¡æ¯](/static/images/mdx/extension/sw-console.png)

#### å¦‚ä½•é€šä¿¡

ç„¶åä¸‹ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•é€šä¿¡ï¼Ÿéœ€è¦å°†å®šæ—¶å™¨ä¿¡æ¯ä» popup çª—å£ä¼ é€’åˆ° Service Worker è„šæœ¬ä¸­

chrome æä¾›äº†ä¸¤ä¸ª API æ¥å®ç°å„ä¸ªç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼š`chrome.runtime.sendMessage` å’Œ `chrome.runtime.onMessage`ï¼Œæ¨èå®‰è£… `@types/chrome` è·å¾—å®Œæ•´çš„ç±»å‹å®šä¹‰

```js:popup.js
const input = document.querySelector('#input-timer')
document.querySelector('#btn-set-timer').addEventListener('click', function () {
  chrome.runtime.sendMessage({
    type: 'set-timer',
    payload: {
      id: 'first-timer',
      timeout: +input.value,
    },
  })
})
```

```js:sw.js
chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  if (request.type === 'set-timer') {
    const { id, timeout } = request.payload
    setTimeout(() => {
      console.log(`Timer ${id} has expired after ${timeout} minutes`)
    }, timeout * 60000)
  }
})
```

è¿™é‡Œä»…å±•ç¤ºåˆ›å»ºå®šæ—¶å™¨çš„é€»è¾‘ï¼Œå–æ¶ˆç­‰é€»è¾‘å¯ä»¥è‡ªè¡Œæ·»åŠ  state ç»´æŠ¤ï¼Œä½†è¿™é‡Œ chrome å‡ºäºæ€§èƒ½å’Œèµ„æºæ¶ˆè€—è€ƒè™‘ï¼Œä¼šåœ¨é—²æ—¶å…³åœ Service Worker è„šæœ¬ï¼š

1. æ— æ“ä½œ 30 ç§’åã€‚æ”¶åˆ°äº‹ä»¶æˆ–è°ƒç”¨æ‰©å±•ç¨‹åº API ä¼šé‡ç½®æ­¤è®¡æ—¶å™¨ã€‚
2. å•ä¸ªè¯·æ±‚ï¼ˆä¾‹å¦‚äº‹ä»¶æˆ– API è°ƒç”¨ï¼‰çš„å¤„ç†ç”¨æ—¶è¶…è¿‡ 5 åˆ†é’Ÿã€‚
3. å½“ fetch() å“åº”æ—¶é—´è¶…è¿‡ 30 ç§’æ—¶ã€‚

å› æ­¤æ›´æ¨èä½¿ç”¨ `chrome.alarms` API æ¥ä»£æ›¿ `setTimeout`ï¼Œé¦–å…ˆåœ¨ manifest.json ä¸­ç”³è¯· alarms æƒé™

```json:manifest.json
{
  "permissions": ["alarms"]
}
```

ç„¶åä¿®æ”¹ Service Worker è„šæœ¬

```js:sw.js
chrome.runtime.onMessage.addListener(async function (request, sender, sendResponse) {
  if (request.type === 'set-timer') {
    const { id, timeout } = request.payload
    await chrome.alarms.create(id, { delayInMinutes: timeout })
  }
})

chrome.alarms.onAlarm.addListener((alarm) => {
  console.log(`Alarm ${alarm.name} has been triggered`)
})
```

### Content Script å†…å®¹è„šæœ¬[^3]

[^3]: [å†…å®¹è„šæœ¬](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)

æ‰©å±•ç¨‹åºå¯ä»¥æ’å…¥å†…å®¹è„šæœ¬æ¥è¯»å–ã€ä¿®æ”¹å½“å‰æ‰€è®¿é—®ç½‘é¡µå†…å®¹ã€‚

é¦–å…ˆåœ¨ manifest.json ä¸­æ·»åŠ æ³¨å†Œï¼Œmatches å­—æ®µå¯æŒ‡å®šç‰¹å®šç½‘å€ï¼Œè¯¦æƒ…è§ [åŒ¹é…æ¨¡å¼](https://developer.chrome.com/docs/extensions/develop/concepts/match-patterns)

```json:manifest.json
{
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content.js"],
      "css": []
    }
  ]
}
```

ç„¶ååœ¨ content.js ä¸­æ·»åŠ å†…å®¹ `console.log('Content Script')`ï¼Œå†…å®¹è„šæœ¬åœ¨å½“å‰ç½‘é¡µæˆåŠŸæ‰§è¡Œ

![å†…å®¹è„šæœ¬æˆåŠŸæ‰§è¡Œ](/static/images/mdx/extension/content-start.png)

#### åŠ¨æ€æ³¨å†Œ

åƒä¸Šé¢è¿™æ ·æ³¨å†Œå†…å®¹è„šæœ¬æˆä¸ºé™æ€è„šæœ¬ï¼Œéƒ¨åˆ†åœºæ™¯æ¯”å¦‚åŒ¹é…æ¨¡å¼æœªçŸ¥ï¼Œæ¯”å¦‚éƒ¨åˆ†æ’ä»¶æä¾› â€œåœ¨å½“å‰é¡µé¢ä¸å¯ç”¨â€ åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Service Worker ä¸­ä½¿ç”¨ `chrome.scripting` æ¥åŠ¨æ€æ³¨å†Œæ›´æ–°å†…å®¹è„šæœ¬

```js:sw.js
chrome.scripting.registerContentScripts([
  {
    id: 'session-script',
    js: ['content.js'],
    persistAcrossSessions: false,
    matches: ['*://example.com/*'],
    runAt: 'document_start',
  },
])

// sometime
chrome.scripting.updateContentScripts([
  {
    id: 'session-script',
    excludeMatches: ['*://sub.example.com/*'], // é¢å¤–æ’é™¤ sub.example.com é¡µé¢ä¸‹çš„å¯ç”¨
  },
])
```

#### è¡¥å……è®¡æ—¶å™¨ä¾‹å­

äº†è§£åˆ°å†…å®¹è„šæœ¬å¯¹æ‰€è®¿é—®é¡µé¢å¯ä»¥è¿›è¡Œçš„æ§åˆ¶ï¼Œè®©æˆ‘ä»¬å›åˆ°ä¸Šé¢è®¡æ—¶å™¨çš„ä¾‹å­ï¼Œç°åœ¨å¸Œæœ›å°†æç¤ºä¿¡æ¯ç›´æ¥æ’å…¥å½“å‰æµè§ˆçš„é¡µé¢ä¸­ï¼Œè¿›è¡Œæ›´æ˜æ˜¾çš„æç¤ºã€‚

ç°åœ¨æ•´ä¸ªåº”ç”¨çš„æ‰§è¡Œæµç¨‹æ˜¯

1. åœ¨ popup å¼¹å‡ºçª—å£ä¸­å¼€å¯é—¹é’Ÿï¼ŒåŒæ­¥åˆ° Service Worker åå°è„šæœ¬ä¸­

```js:popup.js
const input = document.querySelector('#input-timer')
const text = document.querySelector('#timer-rest')

document.querySelector('#btn-set-timer').addEventListener('click', function () {
  chrome.runtime.sendMessage({
    type: 'set-timer',
    payload: +input.value * 60,
  })
})

document.addEventListener('DOMContentLoaded', function () {
  update()
})

async function update() {
  const response = await chrome.runtime.sendMessage({ type: 'get-timer' })
  text.textContent = +response
  setTimeout(update, 1000)
}
```

2. åœ¨ Service Worker ä¸­ä¿å­˜ç»´æŠ¤é—¹é’Ÿçš„çŠ¶æ€ï¼Œå°†å®šæ—¶å™¨çŠ¶æ€åŒæ—¶å¾€ popup å’Œå½“å‰é¡µé¢åŒæ­¥

```js:sw.js
const timers = new Map()

chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  if (request.type === 'set-timer') {
    getActiveTab().then((tab) => {
      const host = new URL(tab.url).hostname
      timers.set(host, request.payload)
      chrome.tabs.sendMessage(tab.id, { type: 'setup' })
    })
  }
  if (request.type === 'get-timer') {
    getActiveTab().then((tab) => {
      const host = new URL(tab.url).hostname
      sendResponse(timers.get(host))
    })
  }
  if (request.type === 'update-timer') {
    getActiveTab().then((tab) => {
      const host = new URL(tab.url).hostname
      if (timers.has(host)) {
        timers.set(host, request.payload)
      }
    })
  }
  return true
})

function getActiveTab() {
  return new Promise((resolve) => {
    chrome.tabs.query({ active: true }, (tabs) => {
      resolve(tabs[0])
    })
  })
}
```

3. åœ¨å†…å®¹è„šæœ¬ä¸­å–åˆ°é—¹é’Ÿçš„çŠ¶æ€ï¼ŒåŒæ—¶æ”¶é›†æœ‰æ•ˆæ—¶é—´åšå¯¹æ¯”ï¼Œå½“æœ‰æ•ˆæ—¶é—´åˆ°è¾¾æ—¶ï¼Œå†…å®¹è„šæœ¬ç›´æ¥åœ¨å½“å‰é¡µé¢æ’å…¥æç¤ºä¿¡æ¯

```js:content.js
let counting = document.visibilityState === 'visible'
let target = 0
let reduce = 0
let setupStamp
let lastStamp

function setup() {
  reset()
  setupStamp = Date.now()
  lastStamp = setupStamp
  chrome.runtime.sendMessage({ type: 'get-timer' }, (response) => {
    target = +response * 1000 // seconds => milliseconds
  })
}

chrome.runtime.onMessage.addListener((message) => {
  if (message.type === 'setup') {
    setup()
  }
})

document.addEventListener('visibilitychange', () => {
  counting = document.visibilityState === 'visible'
  if (document.visibilityState === 'visible') {
    lastStamp = Date.now()
  }
})

function flush() {
  const now = Date.now()
  reduce += now - lastStamp
  lastStamp = now
  chrome.runtime.sendMessage({
    type: 'update-timer',
    payload: Math.round((target - reduce) / 1000),
  })
}
function check() {
  if (reduce > target) {
    const message = `ä½ å·²åœ¨å½“å‰é¡µé¢åœç•™äº† ${target / 1000} ç§’ï¼Œåˆ°è¾¾è®¾å®šæ—¶é—´`
    alert(message)
    reset()
  }
}
function reset() {
  reduce = 0
  target = 0
  setupStamp = null
  lastStamp = null
}
function start() {
  const id = setInterval(() => {
    if (setupStamp && counting) {
      flush()
      check()
    }
  }, 1000)
  return () => clearInterval(id)
}

start()
```

ï¼ˆè¿™é‡Œæ˜¯æœ‰æ›´å¥½çš„æµç¨‹è®¾è®¡ï¼Œæ¯”å¦‚ä½¿ç”¨ `chrome.storage` æˆ–è€… `chrome.notifications` APIï¼Œä»…åšæ•™ç¨‹æ¼”ç¤ºä½¿ç”¨æ­¤æµç¨‹ï¼‰

### å·¥ç¨‹åŒ–

ä½†æ˜¯ä¸Šæ–‡çš„ä¾‹å­è¿˜åªæ˜¯ç®€å•çš„ `alert` æç¤ºä¿¡æ¯ï¼Œéä¸­æ–­äº¤äº’çš„æç¤ºæ˜¯æ›´å¥½çš„ï¼Œä»¥åŠä¸ºäº†è¿½æ±‚æ›´å¥½çš„äº¤äº’ä½“éªŒï¼Œå¯èƒ½éœ€è¦å¼•å…¥ UI æ¡†æ¶å’Œç»„ä»¶åº“æ¥å¸®åŠ©æ„å»ºæ’ä»¶åº”ç”¨ï¼Œå› æ­¤å·¥ç¨‹åŒ–ååˆ†å¿…è¦ã€‚

æˆ‘ä»¬ä»…éœ€è¦æä¾›ä¸€ä¸ªæ’ä»¶çš„ç›®å½•ç»™åˆ°æµè§ˆå™¨åŠ è½½ï¼Œå› æ­¤æˆ‘ä»¬å·¥ç¨‹åŒ–çš„ç›®æ ‡å°±æ˜¯å°†ä»£ç å’Œå„ç§é¢„è®¾èµ„æºæ„å»ºåˆ°æ’ä»¶ç›®å½•å³å¯ã€‚

æ¯”å¦‚æœ‰ popup çª—å£çš„æ ·æ¿ä»£ç ï¼Œå¼•å…¥äº† React å¸®åŠ©æ„å»ºäº¤äº’

```tsx:src/popup/index.tsx
import * as React from 'react'
import * as ReactDom from 'react-dom/client'
import App from './App'
import './index.css'

ReactDom.createRoot(document.querySelector('#extension-popup')).render(<App />)
```

#### webpack

å…ˆåŠ ä¸ŠåŸºç¡€çš„ webpack é…ç½®

```js:webpack.config.js
const path = require('path')
const webpack = require('webpack')
const HtmlWebpackPlugin = require('html-webpack-plugin')

const mode = process.env.NODE_ENV
const isDev = mode === 'development'
const devDirectory = 'dist-dev'

module.exports = {
  mode,
  entry: {
    popup: './src/popup/index.tsx',
    // æš‚æ—¶ä»…æœ‰å•å…¥å£ï¼Œè¿™æ ·å†™é¢„ç•™å¤šå…¥å£
  },
  output: {
    path: path.resolve(__dirname, isDev ? devDirectory : 'build'), // dev å’Œ build åŒºåˆ†ç›®å½•
    clean: true,
    filename: '[name].js',
  },
  resolve: {
    extensions: ['.ts', '.tsx', '.js', '.jsx'],
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        exclude: /node_modules/,
        use: [{ loader: 'ts-loader' }],
      },
      { test: /\.css$/i, use: ['style-loader', 'css-loader'] },
    ],
  },
  plugins: [
    // ç»„è£…æˆ popup.html
    new HtmlWebpackPlugin({
      filename: 'popup.html',
      template: './src/popup/template.html',
      chunks: ['popup'],
    }),
  ],
}
```

æœ€é‡è¦çš„ manifest.json æ–‡ä»¶è¿˜æ²¡æœ‰åŒ…æ‹¬åˆ°æœ€ç»ˆç›®å½•ä¸­ï¼Œæ–°å¢ webpack plugin `npm i copy-webpack-plugin`ï¼Œå°† manifest.json å’Œå…¶ä»–é™æ€èµ„æºæ”¾åœ¨ assets ç›®å½•ä¸‹ï¼Œç„¶åå¤åˆ¶è¿›æœ€ç»ˆæ’ä»¶ç›®å½•ä¸­å³å¯

```js:webpack.config.js
const CopyPlugin = require('copy-webpack-plugin')

module.exports = {
  // ...
  plugins: [
    new CopyWebpackPlugin({
      patterns: [{ from: './assets', to: '.' }],
    }),
  ],
}
```

ç„¶åè¡¥å……ä¸‹ webpack å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­æ›´æ–°ä»£ç ï¼Œå®‰è£… `npm i webpack-dev-server`ï¼Œç„¶åæ–°å¢é…ç½®

```js:webpack.config.js
module.exports = {
  // ...
  devServer: {
    hot: true,
    static: [{ directory: path.resolve(__dirname, devDirectory) }],
    devMiddleware: {
      writeToDisk: (filePath) => {
        // çƒ­æ›´æ–°æ–‡ä»¶åŒæ ·å†™å…¥æ’ä»¶ç›®å½•
        return !/\.hot-update\.(js|json)/.test(filePath)
      },
    },
  },
}
```

è‡³æ­¤ï¼Œå•ç‹¬çš„ popup åº”ç”¨å¼€å‘æµç¨‹å°±å®Œæˆäº†ï¼Œæƒ³æ–°å¢æ’ä»¶çš„å…¶ä»–é¡µé¢ï¼Œæµç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œæ¯”å¦‚æˆ‘æƒ³æ¥ç®¡æµè§ˆå™¨æ–°å¢ Tab

1. manifest.json ä¸­æ–°å¢é¡µé¢é…ç½®

```js:manifest.json
{
  // ...
  "chrome_url_overrides": {
    "newtab": "newtab.html"
  },
}
```

2. æ–°å¢ä»£ç å…¥å£ `src/newtab/index.tsx` `src/newtab/template.html`
3. æ–°å¢ webpack é…ç½®

```js:webpack.config.js
module.exports = {
  // ...
  entry: {
    // ...
    newtab: './src/newtab/index.tsx',
  },
  plugins: [
    // ...
    new HtmlWebpackPlugin({
      template: './src/newtab/template.html',
      filename: 'newtab.html',
      chunks: ['newtab'],
    }),
  ],
}
```

å…¶ä»– options ç­‰é¡µé¢åŒç†ï¼Œä»¥åŠå…¶ä»–æ„å»ºå·¥å…·æ¯”å¦‚ vite ä¹Ÿæ˜¯ç›¸åŒæ€è·¯

#### å†æ¬¡è¡¥å……è®¡æ—¶å™¨ä¾‹å­

é¦–å…ˆ webpack ä¸­æ–°å¢ entry

```js:webpack.config.js
module.exports = {
  entry: {
    content: './src/content/index.tsx',
  },
}
```

è¿˜æ˜¯ç”¨ä¸Šé¢çš„è®¡æ—¶å™¨åº”ç”¨ä½œä¸ºä¾‹å­ï¼Œè¿™é‡Œæƒ³å°†å®šæ—¶ç»“æŸåçš„ `alert` æç¤ºæ”¹æˆæ›´å‹å¥½çš„åœ¨é¡µé¢ä¸­å¼¹å‡ºéä¸­æ–­çš„æç¤ºä¿¡æ¯

åœ¨ Content Script ä½¿ç”¨çº¯ javascript ç¼–ç¨‹çš„æ–¹å¼æ’å…¥ react æ„å»ºçš„äº¤äº’

```js:src/content/index.tsx
import * as React from 'react'
import { createRoot } from 'react-dom/client'
import Message from './Message'

function getRoot() {
  const id = 'extension-timer-message-root'
  if (document.getElementById(id)) {
    return document.getElementById(id)
  }
  const root = document.createElement('div')
  root.id = id
  document.body.appendChild(root)
  return root
}

createRoot(getRoot()).render(<Message />)
```

ä½†æ˜¯è¿˜æ¼äº† CSSï¼Œæ‰€ä»¥è¿˜éœ€è¦ç”¨ç›¸åŒæ–¹æ³•æ’å…¥æ ·å¼ï¼Œä½†éœ€è¦å°† css è½¬æˆçº¯æ–‡æœ¬ä½œä¸º `<style>` æ ‡ç­¾çš„å†…å®¹æ’å…¥ï¼Œå› æ­¤ `npm i raw-loader -D` ç„¶åä½¿ç”¨ webpack çš„ inline loader åŠ è½½ css æ–‡ä»¶

```js:src/content/index.tsx
// ...
import cssText from '!!raw-loader!./style.css'

const style = document.createElement('style')
style.textContent = cssText
document.head.appendChild(style)
```

å¦å¤– `!!raw-loader!./style.css` å¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸º ts å¹¶ä¸è®¤è¯† `!!raw-loader`ï¼Œæ‰€ä»¥éœ€è¦è¡¥å……ä¸‹è¿™ç§æ¨¡å—å£°æ˜

æ–°å¢ `typings.d.ts` ï¼ˆéšæ„ç›®å½•ä¸‹ï¼Œåªè¦ tsconfig.json é…ç½®çš„ `include` å­—æ®µå°†å…¶åŒ…å«è¿›å»å³å¯ï¼‰

```ts:typings.d.ts
declare module '!!raw-loader!*' {
  const content: string
  export default content
}
```

æœ€åè¡¥å……ä¸‹ Message ç»„ä»¶å’Œæä¾› api ç”¨ä»¥æ›¿æ¢ `alert`

```js:src/content/store.ts
import { create } from 'zustand'

interface Message {
  text: string
  duration: number
  id: number
}
interface Store {
  messages: Message[]
  push: (message: Omit<Message, 'id'>) => void
}

let seed = 0
export const useStore = create<Store>((set) => ({
  messages: [],
  push: (message) => {
    seed++
    const newMessage = { ...message, id: seed }
    set((state) => ({
      messages: [...state.messages, newMessage],
    }))
    setTimeout(() => {
      set((state) => ({
        messages: state.messages.filter((msg) => msg.id !== newMessage.id),
      }))
    }, message.duration)
  },
}))

export function showMessage(text: string, duration: number) {
  const { push } = useStore.getState()
  push({ text, duration })
}
```

```js:src/content/Message.tsx
import * as React from 'react'
import { useStore } from './store'
import start from './start'

export default function Message() {
  const { messages } = useStore()
  React.useEffect(() => {
    const un = start()
    return un
  }, [])
  return (
    <div className="timer-container">
      {messages.map((message) => (
        <div key={message.id} className="message-item">{message.text}</div>
      ))}
    </div>
  )
}
```

è¿™é‡Œçš„ start å³ä¸Šæ–‡ä¾‹å­ä¸­ content.js ä¸­çš„ `start` å‡½æ•°ï¼Œæœ€åæ‰¾ä¸ªé¡µé¢æµ‹è¯•ä¸‹æ•ˆæœ

![è®¡æ—¶å™¨åº”ç”¨çš„æµ‹è¯•æ•ˆæœå›¾](/static/images/mdx/extension/timer-tip.png)

ä»¥ä¸Š demo ä»£ç è§ [github](https://github.com/stillsailing/extension-examples)

### å¦ä¸€ä¸ªä¾‹å­

ç°åœ¨æ¥çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘æ˜¯ä¸€ä¸ª Web å¼€å‘è€…ï¼Œéœ€è¦ç»å¸¸æ‰“å¼€ MDN æŸ¥è¯¢ä¸€äº› APIï¼Œæˆ‘çš„æ“ä½œæµç¨‹æ˜¯ï¼š

1. æ‰“å¼€æ–°çª—å£
2. åœ¨åœ°å€æ è¾“å…¥ mdn å…³é”®å­—ï¼Œç­‰å¾…å…¶è‡ªåŠ¨è¡¥å…¨å†å²è®°å½•ä¸‹æ‹‰åˆ—è¡¨
3. åœ¨å†å²è®°å½•ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©ä¸€ä¸ª mdn çš„ç½‘å€ï¼Œç‚¹å‡»è¿›å…¥
4. ç‚¹å‡»é¡µé¢ä¸­çš„æœç´¢è¾“å…¥æ¡†è¾“å…¥æˆ‘æƒ³æŸ¥è¯¢çš„å…³é”®è¯ï¼Œå›è½¦è¿›å…¥åˆ° mdn çš„æŸ¥è¯¢ç»“æœé¡µé¢

å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç›´æ¥æ”¶è— mdn ç½‘å€ï¼Œéœ€è¦ç›´æ¥æ‰“å¼€å³å¯ï¼Œä½†ç›¸ä¿¡ä¹Ÿæœ‰éƒ¨åˆ†äººå’Œæˆ‘ä¸€æ ·ä¸å–œæ¬¢ä½¿ç”¨ä¹¦ç­¾æ ï¼Œå¦‚æœå€ŸåŠ©æ‰©å±•ç¨‹åºï¼Œç»å¯¹å¯ä»¥å°†è¿™ä¸ªæµç¨‹ç®€åŒ–å¾ˆå¤š

### Omnibox å¤šåŠŸèƒ½æ¡†

æ‰©å±•ç¨‹åºä¸­èƒ½åšäº‹æƒ…è¿˜æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬æ‰©å±• Omnibox å¤šåŠŸèƒ½æ¡†ï¼Œä½†è¿™ä¹ˆè¯´ä½ å¯èƒ½æœ‰ç‚¹ä¸çŸ¥æ‰€äº‘ï¼Œè¿™ä¸ª Omnibox å…¶å®å°±æ˜¯åœ°å€æ ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­ç§°å…¶ä¸ºå¤šåŠŸèƒ½æ¡†ã€‚

![Omnibox ä¾‹å›¾](/static/images/mdx/extension/omnibox.png)

å›åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œå¸Œæœ›æ€ä¹ˆç®€åŒ–è¿™ä¸ªæŸ¥è¯¢æµç¨‹å‘¢ï¼Ÿæˆ‘è®¾æƒ³ï¼š

1. æ‰“å¼€æ–°çª—å£
2. åœ¨åœ°å€æ è¾“å…¥ `mdn <search content>` å›è½¦
3. ç›´æ¥è®¿é—® mdn çš„æŸ¥è¯¢ç»“æœé¡µé¢

ç„¶åæˆ‘æ‰“å¼€æ’ä»¶å•†åº—ï¼Œæœç´¢ â€œsearch in mdnâ€ï¼Œæœç„¶å·²ç»æœ‰äººå¼€å‘è¿‡äº†ç±»ä¼¼çš„ [æ’ä»¶](https://chromewebstore.google.com/detail/mdn-%E6%90%9C%E7%B4%A2/pdiegkghjahhhikafojgcmflngomilki)

![Search in MDN](/static/images/mdx/extension/omnibox-mdn.png)

ä½“éªŒæ•ˆæœè¿˜æ˜¯å¾ˆå¥½çš„ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»å¦‚ä½•å®ç°ï¼Ÿ

é¦–å…ˆè¿˜æ˜¯åœ¨ manifest.json ä¸­æ·»åŠ  omnibox é…ç½®ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ `omnibox.keyword` é…ç½®æ¿€æ´»æ’ä»¶çš„å…³é”®å­—

```json:manifest.json
{
  // ...
  "omnibox": {
    "keyword": "mdn"
  }
}
```

åŠ è½½æ’ä»¶åï¼Œåœ¨åœ°å€æ è¾“å…¥ `mdn` åŠ ç©ºæ ¼ï¼Œå°±å¯ä»¥çœ‹åˆ°æ’ä»¶å·²ç»æ¿€æ´»

![Search in MDN](/static/images/mdx/extension/omnibox-active.png)

ç„¶ååœ¨ Service Worker ä¸­æ·»åŠ  `chrome.omnibox.onInputChanged` å’Œ `chrome.omnibox.onInputEntered` äº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬ç”¨æˆ·è¾“å…¥å¹¶ç»™å‡ºæç¤ºå†…å®¹ï¼ˆè®°å¾—åœ¨ manifest ä¸­è¡¥å…… `background.service_worker` å­—æ®µï¼‰

```js:service_worker.js
chrome.omnibox.onInputChanged.addListener(function (text, suggest) {
  suggest([
    { content: text, description: 'Open MDN' },
    {
      content: 'https://developer.mozilla.org/zh-CN/search?q=' + text,
      description: 'Search in MDN',
    },
  ])
})

chrome.omnibox.onInputEntered.addListener(function (text) {
  const url = /https?:\/\//g.test(text)
    ? text
    : `https://developer.mozilla.org/zh-CN/search?q=${text}`
  chrome.tabs.create({ url })
})
```

### Context Menu å³é”®èœå•

ä½†è¿˜æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œæ¯”å¦‚åœ¨é˜…è¯»ä¸€ç¯‡æŠ€æœ¯åšå®¢æ—¶ï¼Œæåˆ°äº†ä¸€ä¸ª Web APIï¼Œæˆ‘æƒ³è¦é€‰ä¸­ç„¶åå³é”®èœå•ç›´æ¥åœ¨ MDN ä¸­æœç´¢

è¿˜å¥½ï¼Œæ‰©å±•ç¨‹åºåŒæ ·æ”¯æŒæ‰©å±• Context Menu å³é”®èœå•ï¼Œé¦–å…ˆåœ¨ manifest é…ç½®æ¸…å•ä¸­æ–°å¢å­—æ®µ

```json:manifest.json
{
  "permissions": ["contextMenus"],
}
```

ç„¶ååœ¨ Service Worker ä¸­åº”ç”¨å®‰è£…åï¼ˆæ›´å¤šç”Ÿå‘½å‘¨æœŸè§[æ–‡æ¡£](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers/lifecycle)ï¼‰è°ƒç”¨ `chrome.contextMenus.create` æ’å…¥èœå•ï¼ŒæŒ‡å®šæœ‰æ–‡æœ¬é€‰ä¸­æ—¶æ‰å¯ç”¨ï¼Œç„¶åç›‘å¬èœå•ç‚¹å‡» `chrome.contextMenus.onClicked`ï¼Œå–åˆ°é€‰ä¸­æ–‡æœ¬ï¼Œå¹¶åœ¨å½“å‰ç½‘é¡µå³ä¾§æ’å…¥ tab æ‰“å¼€ MDN æœç´¢ç»“æœé¡µé¢

```js:service_worker.js
chrome.runtime.onInstalled.addListener(async () => {
  chrome.contextMenus.create({
    id: 'search-in-mdn',
    title: 'Search in MDN"',
    type: 'normal',
    contexts: ['selection'],
  })
})

chrome.contextMenus.onClicked.addListener(function (info, tab) {
  const selection = info.selectionText
  const newTabIndex = tab.index + 1
  const url = `https://developer.mozilla.org/zh-CN/search?q=${selection}`
  chrome.tabs.create({ url, index: newTabIndex })
})
```

æ‰¾ä¸ªé¡µé¢æµ‹è¯•ä¸€ä¸‹ï¼Œé€‰ä¸­æ–‡æœ¬åå³é”®ç‚¹å‡» â€œSeach in MDNâ€ ç‚¹å‡»å³è·³è½¬åˆ°æ–°é¡µé¢ï¼Œè¿™æ¯”æœ€å…ˆçš„æµç¨‹è¦æ–¹ä¾¿çš„å¤ªå¤šäº†

![Search in MDN](/static/images/mdx/extension/menu-select.png)

ä»¥ä¸Šä¾‹å­å·²æ‰“åŒ…æˆæ‰©å±•ç¨‹åºå‘å¸ƒåˆ° [github](https://github.com/stillsailing/search-in-mdn)ï¼Œæ¬¢è¿è¯•ç”¨ä½“éªŒ

### More

æ‰©å±•ç¨‹åºå¯ä»¥æ‰©å±•çš„æ›´å¤šåŠŸèƒ½ï¼šDevtools å¼€å‘è€…å·¥å…·ã€Sidepanel ä¾§è¾¹æ ç­‰ä¸å†ä¸€ä¸€è¯´æ˜ï¼Œå¯ä»¥å‚è§ä¸‹æ–‡æ›´å¤šä¾‹å­æŸ¥çœ‹

### å®‰å…¨é—®é¢˜

#### CSP å†…å®¹å®‰å…¨ç­–ç•¥

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶åªèƒ½ä»è‡ªå·±ç›®å½•åŠ è½½èµ„æºï¼Œç›¸å½“äºæœ‰é»˜è®¤é…ç½®

```json:manifest.json
{
  "content_security_policy": {
    "extension_pages": "script-src 'self'; object-src 'self"
  }
}
```

å¹¶ä¸”ç”±äºæ‰©å±•ç¨‹åºå±äºé«˜æƒé™ç¯å¢ƒï¼Œå› æ­¤ä¸æ”¯æŒé…ç½® `unsafe-eval`ï¼Œ`eval()`ã€`new Function()`ã€`setTimeout(String)`ã€`setInterval(String)` æ‹¥æœ‰åŠ¨æ€æ‰§è¡Œä»£ç èƒ½åŠ›çš„ä»£ç éƒ½è¢«ç¦ç”¨

#### Sandbox æ²™ç®±æœºåˆ¶

å¦‚æœå¿…é¡»ä½¿ç”¨çš„è¯ï¼Œå¹¶ä¸æ˜¯æ²¡æœ‰åŠæ³•ï¼Œè¿˜æ˜¯ä¸¾ä¾‹è¯´æ˜ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªå¼¹å‡ºçª—å£ä¸­çš„è®¡ç®—å™¨ï¼Œè¾“å…¥è®¡ç®—å…¬å¼ï¼Œç‚¹å‡»è®¡ç®—å³å¯å¾—åˆ°ç»“æœ

```json:manifest.json
{
  "sandbox": {
    "pages": ["sandbox.html"]
  }
}
```

æä¾› sandbox.html ç„¶åé€šè¿‡ iframe åŠ è½½å¹¶é€šä¿¡ï¼ˆåœ¨ sandbox ä¸­è¢«ç¦æ­¢è°ƒç”¨è¯¸å¦‚ `chrome.*` çš„ä»»ä½•æµè§ˆå™¨æ‰©å±•ç¨‹åº APIï¼‰

```html:popup.html
<body>
  <input id="formula" />
  <button id="calc">Calc</button>
  <div id="result"></div>
  <iframe id="sandbox" src="sandbox.html" style="display: none"></iframe>
</body>
```

ç„¶ååœ¨ sandbox.html ä¸­é€šè¿‡ `message` äº‹ä»¶å’Œ `postMessage` ä¸ popup.html è¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨ `eval` è®¡ç®—å‡ºç»“æœå¹¶è¿”å›

```js:sandbox.html
window.addEventListener("message", async function (event) {
  const source = event.source as { window: WindowProxy }
  source.window.postMessage(eval(event.data), event.origin)
})
```

#### å¼€å‘å’Œä½¿ç”¨æ³¨æ„

1. æƒé™æœ€å°åŒ–åŸåˆ™ï¼šåº”åªè¯·æ±‚å®Œæˆå…¶åŠŸèƒ½æ‰€éœ€çš„æœ€å°æƒé™ï¼Œé¿å…è¯·æ±‚ä¸å¿…è¦çš„æƒé™ã€‚
2. è°¨æ…æˆæƒï¼šå®‰è£…å‰ä»”ç»†æŸ¥çœ‹å…¶è¯·æ±‚çš„æƒé™åˆ—è¡¨ï¼Œè¯„ä¼°å…¶åˆç†æ€§ã€‚å¦‚æœä¸€ä¸ªæ”¶è—å¤¹ç®¡ç†æ’ä»¶è¯·æ±‚è®¿é—® webRequest ç­‰æƒé™ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œåº”è¯¥æ‹’ç»å®‰è£…ã€‚

## æ¡ˆä¾‹åˆ†äº«

### å¤©æ°”é¢„æŠ¥

åå°è„šæœ¬ä¸­è·å–å¤©æ°”ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ `chrome.action.setIcon` è®¾ç½®å›¾æ ‡

```js:sw.js
chrome.action.setIcon({
  path: getIconPath(alarm.name),
});
```

### éŸ³ä¹æ’­æ”¾å™¨

è¯¦æƒ…å¯è§[ã€Šå¦‚ä½•åœ¨æµè§ˆå™¨æ‰©å±•ç¨‹åºä¸­åˆ›å»ºéŸ³ä¹æ’­æ”¾å™¨ã€‹](/blog/music-player-in-extension)

1. åœ¨ service_worker ä¸­åˆ›å»º offsrceen document
2. åœ¨ offsrceen document ä¸­åˆ›å»º audio
3. ä½¿ç”¨ `chrome.runtime.onMessage` é€šä¿¡

### Input Completer

1. åˆ›å»º Content Script æ’å…¥äº¤äº’
2. ç”±äºåŒæºç­–ç•¥ï¼Œæ‰€æœ‰è¯·æ±‚ç”±æ’ä»¶çš„ Service Worker ä»£ç†

### Wappalyzer

åˆ†æé¡µé¢çš„ HTMLã€CSSã€JS ä»£ç ï¼Œç„¶åé€šè¿‡æ­£åˆ™åŒ¹é…ï¼Œæå–å‡ºé¡µé¢çš„æ¡†æ¶ä¿¡æ¯

1. HTML ç‰¹å¾ï¼Œåˆ†æç½‘é¡µçš„ HTML æºä»£ç ï¼ŒæŸ¥æ‰¾ç‰¹å®šçš„æ ‡ç­¾ã€å±æ€§ã€å…ƒæ•°æ®ã€è„šæœ¬é“¾æ¥ã€CSS æ ·å¼è¡¨é“¾æ¥ç­‰ï¼Œè¿™äº›ç‰¹å¾å¯ä»¥æŒ‡ç¤ºç½‘ç«™ä½¿ç”¨äº†å“ªäº›æŠ€æœ¯ã€‚

- `<meta name="generator" content="WordPress">`
- `<script src="https://cdn.jquery.com/jquery.min.js">`

2. å“åº”å¤´ç‰¹å¾ï¼Œä½¿ç”¨ `chrome.webRequest` è§‚å¯Ÿé¡µé¢è¯·æ±‚ï¼Œåˆ†æ HTTP å“åº”å¤´ï¼ŒæŸ¥æ‰¾ç‰¹å®šçš„å­—æ®µå’Œå€¼ï¼Œä¾‹å¦‚ Serverã€X-Powered-Byã€Set-Cookie ç­‰ï¼Œè¿™äº›ç‰¹å¾å¯ä»¥æŒ‡ç¤ºç½‘ç«™ä½¿ç”¨äº†å“ªäº›æœåŠ¡å™¨è½¯ä»¶ã€ç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶ç­‰ã€‚
3. JS ç‰¹å¾ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸èƒ½ç›´æ¥è®¿é—®é¡µé¢åŠ è½½çš„ JavaScript æ–‡ä»¶å†…å®¹ã€‚ä½†æ˜¯å¯ä»¥æ ¹æ®åŠ è½½é“¾æ¥ï¼ŒæŸ¥æ‰¾ window å¯¹è±¡ï¼ŒDOM ç»“æ„ç­‰ï¼Œæ¨æ–­å‡ºä½¿ç”¨äº†å“ªäº› JavaScript åº“æˆ–æ¡†æ¶ã€‚

## ä½¿ç”¨æ¡†æ¶ç®€åŒ–å¼€å‘æµç¨‹

- [plasmo](https://www.plasmo.com/)

- [wxt](https://wxt.dev/)
