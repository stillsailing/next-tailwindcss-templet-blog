---
title: äº†è§£å’Œå¼€å‘ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶
date: '2024-10-21'
tags: ['browser', 'chrome', 'extension']
draft: false
summary: è®¤è¯†ä»€ä¹ˆæ˜¯æµè§ˆå™¨æ’ä»¶ä»¥åŠå¦‚ä½•å¼€å‘ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶ï¼Œå®ç°å„ç§åŠŸèƒ½...
---

å¦‚æœæ‚¨è¿˜æœªä½¿ç”¨è¿‡æµè§ˆå™¨æ’ä»¶ï¼Œå¯ä»¥æ‰“å¼€ [Chrome æµè§ˆå™¨æ’ä»¶å•†åº—](https://chromewebstore.google.com/category/extensions) çœ‹çœ‹

![Chrome æµè§ˆå™¨æ’ä»¶å•†åº—](/static/images/mdx/extension/store.png)

å’Œä»¥å¾€æ‰€è§åˆ°çš„æ’ä»¶ç³»ç»Ÿçš„å®šä¹‰ç›¸åŒï¼Œæµè§ˆå™¨æ’ä»¶ä¹Ÿæ˜¯ç”¨æ¥å¢å¼ºæµè§ˆå™¨çš„åŠŸèƒ½ï¼Œæ­£å¦‚ä¸Šå›¾ä¸­çš„å‰¯æ ‡é¢˜ï¼šâ€œè®©æµè§ˆå™¨å¦‚è™æ·»ç¿¼â€

è€Œæ ¹æ®å…·ä½“éœ€è¦å¯ä»¥é€‰æ‹©ä¸åŒçš„æ’ä»¶å¢å¼ºä¸åŒåŠŸèƒ½ï¼ŒåŒæ ·è§ä¸Šå›¾ä¸‹åŠéƒ¨åˆ†çš„â€œçƒ­é—¨åˆ†ç±»â€

ä¸å¦¨é€‰æ‹©ä¸‹è½½è¯•ç”¨ä¸‹å‡ ä¸ªæ’ä»¶ï¼ˆä»…ä¸¾ä¾‹ï¼Œå¯è‡ªç”±é€‰æ‹©è¯•ç”¨ï¼‰

1. [DeepLï¼šäººå·¥æ™ºèƒ½ç¿»è¯‘å™¨å’Œå†™ä½œåŠ©æ‰‹](https://chromewebstore.google.com/detail/deepl%EF%BC%9A%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%BF%BB%E8%AF%91%E5%99%A8%E5%92%8C%E5%86%99%E4%BD%9C%E5%8A%A9%E6%89%8B/cofdbpoegempjloogbagkncekinflcnj) åˆ’è¯ç¿»è¯‘ï¼Œæ— éœ€å†å¤åˆ¶åˆ°ç¿»è¯‘è½¯ä»¶ä¸­ç²˜è´´æŸ¥çœ‹è¯‘æ–‡
2. [Popup my Bookmarks](https://chromewebstore.google.com/detail/popup-my-bookmarks/mppflflkbbafeopeoeigkbbdjdbeifni) ä¹¦ç­¾ç®¡ç†ï¼Œä¸ªäººä¹ æƒ¯ä¸å±•ç¤ºæµè§ˆå™¨ä¹¦ç­¾æ ï¼Œç‚¹å‡»æ’ä»¶å›¾æ ‡å³å±•å¼€ä¹¦ç­¾
3. [Text Blaze: Templates and Snippets](https://chromewebstore.google.com/detail/text-blaze-templates-and/idgadaccgipmpannjkmfddolnnhmeklj) è¾“å…¥æ¡†è¡¥å…¨ï¼Œå¯ä»¥é¢„è®¾å¸¸ç”¨ç‰‡æ®µï¼Œæ¯”å¦‚é‚®ä»¶ã€è´¦å·ã€å¯†ç ç­‰ï¼Œæµè§ˆå™¨ä¸­çš„è¾“å…¥åœºæ™¯å°±å¯ä»¥ä¸€é”®è¡¥å…¨

è¿˜æœ‰å„ç§åœºæ™¯å¯ä»¥è§£é”ï¼Œç†Ÿç»ƒä½¿ç”¨å„ç§æ’ä»¶ç»å¯¹å¯ä»¥æå‡ä½ çš„å·¥ä½œå­¦ä¹ æ•ˆç‡

## æ’ä»¶éƒ½å¯ä»¥åšä»€ä¹ˆ

1. å¢å¼º Tab é¡µï¼Œæ–°å¢æˆ–åˆ é™¤å†…å®¹ï¼Œæ¯”å¦‚ [DeepL](https://chromewebstore.google.com/detail/deepl%EF%BC%9A%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%BF%BB%E8%AF%91%E5%99%A8%E5%92%8C%E5%86%99%E4%BD%9C%E5%8A%A9%E6%89%8B/cofdbpoegempjloogbagkncekinflcnj) å¯ä»¥åˆ’è¯å°±åœ°ç¿»è¯‘å±•ç¤ºï¼Œå¼¹å‡ºçª—å£å¹¶ä¸æ˜¯å½“å‰è®¿é—®é¡µé¢æ‰€æ„å»ºçš„ï¼Œè€Œæ˜¯ç”±æ’ä»¶åˆ›å»ºå¹¶æ’å…¥è¿›å½“å‰é¡µé¢çš„
2. å¢å¼ºè®¾ç½®æ“ä½œæŒ‰é’®ï¼Œæ¯ä¸ªæ’ä»¶éƒ½ä¼šå±•ç¤ºåœ¨å³ä¸Šéƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥è®¾ç½®å…¶æ”¶èµ·æˆ–å±•å¼€å±•ç¤ºæ’ä»¶å›¾æ ‡ï¼Œç‚¹å‡»å›¾æ ‡æ—¶ä¼šå±•ç¤ºæ’ä»¶æä¾›çš„ popup å¼¹å‡ºçª—å£ï¼Œæ¯”å¦‚ [å¤©æ°” - Weather](https://chromewebstore.google.com/detail/%E5%A4%A9%E6%B0%94-weather/ibieofighcnndjcjchdahdiacjpmkhgf) ç›´æ¥å›¾æ ‡å±•ç¤ºä»Šæ—¥å¤©æ°”ï¼Œç‚¹å‡»å±•å¼€å¼¹å‡ºçª—å£æŸ¥çœ‹æ›´å¤šä¿¡æ¯
3. å¢å¼ºå³é”®å·¥å…·æ ï¼Œè®¿é—®ä»»ä½•é¡µé¢éƒ½å¯ä»¥å³é”®æ“ä½œæµè§ˆå™¨ï¼Œå¯ä»¥åœ¨æ­¤æ–°å¢å¿«æ·æ“ä½œ
4. å¢å¼ºæ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œå¯ä»¥æ›¿æ¢æµè§ˆå™¨æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œè‡ªå®šä¹‰ä»»ä½•å†…å®¹ï¼Œæ¯”å¦‚ [Clear New Tab](https://chromewebstore.google.com/detail/clear-new-tab/felphkbfjadmcejnibcmcncimlappdde) å¯ä»¥æ›¿æ¢é»˜è®¤æ–°æ ‡ç­¾é¡µï¼Œæ›¿æ¢ä¸ºä¸€ä¸ªç®€æ´çš„ç©ºç™½é¡µ
5. å¢å¼ºå¼€å‘è€…å·¥å…·ï¼Œæ¯”å¦‚ [Redux DevTools](https://chromewebstore.google.com/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd) å¯ä»¥æŸ¥çœ‹ Redux çŠ¶æ€æ ‘

## å¦‚ä½•å¼€å‘[^1]

[^1]: [æ¬¢è¿ä½¿ç”¨æ‰©å±•ç¨‹åºï¼](https://developer.chrome.com/docs/extensions)

é¦–å…ˆä¸€ä¸ªæ’ä»¶ç›®å½•åŒ…æ‹¬ [manifest.json](https://developer.chrome.com/docs/extensions/reference/manifest) é…ç½®æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€å°æ¸…å•å†…å®¹ï¼š

```json:manifest.json
{
  "manifest_version": 3,
  "name": "Extension Name",
  "description": "Extension Description",
  "version": "1.0.0"
}
```

### popup å¼¹å‡ºçª—å£

åœ¨ manifest.json æ–°å¢ action é…ç½®ï¼Œå¹¶åœ¨æ’ä»¶ç›®å½•ä¸­æä¾› popup.htmlï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•å¸¸è§„çš„ HTML é¡µé¢

```json:manifest.json
{
  "action": {
    "default_popup": "popup.html"
  }
}
```

åœ¨ç‚¹å‡»å›¾æ ‡æ—¶å³å¯å¼¹å‡ºçª—å£å±•ç¤º popup.html å†…å®¹

![popup.html](/static/images/mdx/extension/popup.png)

### Service Worker åå°è„šæœ¬[^2]

[^2]: [æ‰©å±•ç¨‹åº Service Worker ç®€ä»‹](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers)

æœ¬æ–‡ä¸åšè¯¦ç»† API ä»‹ç»ï¼Œè¯¦æƒ…è¯·å‚è§[æ–‡æ¡£](https://developer.chrome.com/docs/extensions/develop/concepts/service-workers)

è¯•æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘è¿›å…¥äº†ä¸€ä¸ªé˜…è¯»ç½‘ç«™ï¼Œä½†æˆ‘åªæƒ³åœ¨å½“å‰é¡µé¢é˜…è¯» 15 åˆ†é’Ÿï¼Œä¸æƒ³åœ¨æ­¤è€—è´¹å¤ªå¤šæ—¶é—´ï¼Œæˆ‘ç‚¹å¼€å³ä¸Šè§’çš„å®šæ—¶å™¨æ’ä»¶ï¼Œå¸Œæœ›åœ¨æ­¤é¡µé¢é˜…è¯»åœç•™ 15 åˆ†é’Ÿåé—¹é“ƒæç¤ºæˆ‘ã€‚
æ³¨æ„ä¸æ˜¯å®šæ—¶ 15 åˆ†é’Ÿï¼Œè€Œæ˜¯åœ¨å½“å‰é¡µé¢é˜…è¯»æ»¡ 15 åˆ†é’Ÿï¼Œä¸ç„¶ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨é—¹é’Ÿå‘¢ï¼ŸğŸ¤£

è¿™ç§åœºæ™¯ä¸‹æˆ‘ä»¬è€ƒè™‘ä¸‹å¦‚ä½•å®ç°ï¼Ÿé¦–å…ˆæ˜¯æ•´ä¸ªåº”ç”¨æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ˆå…¶ä»–éƒ¨åˆ†ä¸‹æ–‡å†ç»§ç»­è¡¥å……ï¼‰ï¼šå®šæ—¶å™¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ popup ä¸­å®ç°å¹¶ç»´æŠ¤å®šæ—¶å™¨ï¼Œä¸€æ—¦å…³é—­ popupï¼Œä¿å­˜åœ¨å†…å­˜ä¸­çš„å®šæ—¶å™¨ä¹Ÿä¼šéšç€ç¨‹åºçš„å…³é—­è€Œé”€æ¯ï¼Œé‡æ–°æ‰“å¼€æ—¶åˆæ˜¯ä¸€ä¸ªåˆå§‹åŒ–æµç¨‹ã€‚

è¿™æ—¶å°±éœ€è¦å€ŸåŠ©ä¸€ä¸ªå¯ä»¥æŒç»­è¿è¡Œçš„åå°è„šæœ¬ï¼Œå’Œ Web åº”ç”¨ä¸€æ ·ï¼Œæ’ä»¶ä¹Ÿæ”¯æŒæ³¨å†Œ Service Worker åå°è„šæœ¬

```json:manifest.json
{
  "background": {
    "service_worker": "sw.js"
  }
}
```

åœ¨ç›®å½•ä¸­æ–°å»º sw.js å¹¶å†™å…¥å†…å®¹

```js:sw.js
console.log("Service Worker Script")
setInterval(function () {
  console.log("log from service worker every 3s")
}, 3000)
```

ç„¶åæ‰“å¼€æ’ä»¶ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»åˆ·æ–°é‡è½½æ’ä»¶ï¼Œå°±å¯ä»¥çœ‹åˆ° â€œæ£€æŸ¥è§†å›¾ Service Workerâ€

![åŠ è½½ sw.js](/static/images/mdx/extension/sw-load.png)

ç‚¹å‡»ä¼šæ–°çª—å£æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå°±å¯ä»¥çœ‹åˆ° Service Worker è„šæœ¬çš„æ‰§è¡Œæ—¥å¿—ï¼Œ`setInterval` å¯ä»¥æ­£å¸¸æŒç»­æ‰§è¡Œ

![æŸ¥çœ‹ sw.js console ä¿¡æ¯](/static/images/mdx/extension/sw-console.png)

#### å¦‚ä½•é€šä¿¡

ç„¶åä¸‹ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•é€šä¿¡ï¼Ÿéœ€è¦å°†å®šæ—¶å™¨ä¿¡æ¯ä» popup çª—å£ä¼ é€’åˆ° Service Worker è„šæœ¬ä¸­

chrome æä¾›äº†ä¸¤ä¸ª API æ¥å®ç°å„ä¸ªç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼š`chrome.runtime.sendMessage` å’Œ `chrome.runtime.onMessage`ï¼Œæ¨èå®‰è£… `@types/chrome` è·å¾—å®Œæ•´çš„ç±»å‹å®šä¹‰

```js:popup.js
const input = document.querySelector('#input-timer')
document.querySelector('#btn-set-timer').addEventListener('click', function () {
  chrome.runtime.sendMessage({
    type: 'set-timer',
    payload: {
      id: 'first-timer',
      timeout: +input.value,
    },
  })
})
```

```js:sw.js
chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  if (request.type === 'set-timer') {
    const { id, timeout } = request.payload
    setTimeout(() => {
      console.log(`Timer ${id} has expired after ${timeout} minutes`)
    }, timeout * 60000)
  }
})
```

è¿™é‡Œä»…å±•ç¤ºåˆ›å»ºå®šæ—¶å™¨çš„é€»è¾‘ï¼Œå–æ¶ˆç­‰é€»è¾‘å¯ä»¥è‡ªè¡Œæ·»åŠ  state ç»´æŠ¤ï¼Œä½†è¿™é‡Œ chrome å‡ºäºæ€§èƒ½å’Œèµ„æºæ¶ˆè€—è€ƒè™‘ï¼Œä¼šåœ¨é—²æ—¶å…³åœ Service Worker è„šæœ¬ï¼š

1. æ— æ“ä½œ 30 ç§’åã€‚æ”¶åˆ°äº‹ä»¶æˆ–è°ƒç”¨æ‰©å±•ç¨‹åº API ä¼šé‡ç½®æ­¤è®¡æ—¶å™¨ã€‚
2. å•ä¸ªè¯·æ±‚ï¼ˆä¾‹å¦‚äº‹ä»¶æˆ– API è°ƒç”¨ï¼‰çš„å¤„ç†ç”¨æ—¶è¶…è¿‡ 5 åˆ†é’Ÿã€‚
3. å½“ fetch() å“åº”æ—¶é—´è¶…è¿‡ 30 ç§’æ—¶ã€‚

å› æ­¤æ›´æ¨èä½¿ç”¨ `chrome.alarms` API æ¥ä»£æ›¿ `setTimeout`ï¼Œé¦–å…ˆåœ¨ manifest.json ä¸­ç”³è¯· alarms æƒé™

```json:manifest.json
{
  "permissions": ["alarms"]
}
```

ç„¶åä¿®æ”¹ Service Worker è„šæœ¬

```js:sw.js
chrome.runtime.onMessage.addListener(async function (request, sender, sendResponse) {
  if (request.type === 'set-timer') {
    const { id, timeout } = request.payload
    await chrome.alarms.create(id, { delayInMinutes: timeout })
  }
})

chrome.alarms.onAlarm.addListener((alarm) => {
  console.log(`Alarm ${alarm.name} has been triggered`)
})
```

### Content Script å†…å®¹è„šæœ¬[^3]

[^3]: [å†…å®¹è„šæœ¬](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)

æ‰©å±•ç¨‹åºå¯ä»¥æ’å…¥å†…å®¹è„šæœ¬æ¥è¯»å–ã€ä¿®æ”¹å½“å‰æ‰€è®¿é—®ç½‘é¡µå†…å®¹ã€‚

é¦–å…ˆåœ¨ manifest.json ä¸­æ·»åŠ æ³¨å†Œï¼Œmatches å­—æ®µå¯æŒ‡å®šç‰¹å®šç½‘å€ï¼Œè¯¦æƒ…è§ [åŒ¹é…æ¨¡å¼](https://developer.chrome.com/docs/extensions/develop/concepts/match-patterns)

```json:manifest.json
{
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content.js"],
      "css": []
    }
  ]
}
```

ç„¶ååœ¨ content.js ä¸­æ·»åŠ å†…å®¹ `console.log('Content Script')`ï¼Œå†…å®¹è„šæœ¬åœ¨å½“å‰ç½‘é¡µæˆåŠŸæ‰§è¡Œ

![å†…å®¹è„šæœ¬æˆåŠŸæ‰§è¡Œ](/static/images/mdx/extension/content-start.png)

#### åŠ¨æ€æ³¨å†Œ

åƒä¸Šé¢è¿™æ ·æ³¨å†Œå†…å®¹è„šæœ¬æˆä¸ºé™æ€è„šæœ¬ï¼Œéƒ¨åˆ†åœºæ™¯æ¯”å¦‚åŒ¹é…æ¨¡å¼æœªçŸ¥ï¼Œæ¯”å¦‚éƒ¨åˆ†æ’ä»¶æä¾› â€œåœ¨å½“å‰é¡µé¢ä¸å¯ç”¨â€ åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Service Worker ä¸­ä½¿ç”¨ `chrome.scripting` æ¥åŠ¨æ€æ³¨å†Œæ›´æ–°å†…å®¹è„šæœ¬

```js:sw.js
chrome.scripting.registerContentScripts([
  {
    id: 'session-script',
    js: ['content.js'],
    persistAcrossSessions: false,
    matches: ['*://example.com/*'],
    runAt: 'document_start',
  },
])

// sometime
chrome.scripting.updateContentScripts([
  {
    id: 'session-script',
    excludeMatches: ['*://sub.example.com/*'], // é¢å¤–æ’é™¤ sub.example.com é¡µé¢ä¸‹çš„å¯ç”¨
  },
])
```

#### æ’å…¥äº¤äº’

å›åˆ°ä¸Šé¢è®¡æ—¶å™¨çš„ä¾‹å­ï¼Œç°åœ¨å¸Œæœ›å°†æç¤ºä¿¡æ¯ç›´æ¥æ’å…¥å½“å‰æµè§ˆçš„é¡µé¢ä¸­ï¼Œæ‰“æ–­é˜…è¯»ï¼Œæ›´æ˜æ˜¾çš„è¿›è¡Œæç¤ºã€‚

ç°åœ¨æ•´ä¸ªåº”ç”¨çš„æ‰§è¡Œæµç¨‹æ˜¯

1. åœ¨ popup å¼¹å‡ºçª—å£ä¸­å¼€å¯é—¹é’Ÿï¼ŒåŒæ­¥åˆ° Service Worker åå°è„šæœ¬ä¸­
2. åœ¨ Service Worker ä¸­ä¿å­˜ç»´æŠ¤é—¹é’Ÿçš„çŠ¶æ€
3. åœ¨å†…å®¹è„šæœ¬ä¸­å–åˆ°é—¹é’Ÿçš„çŠ¶æ€ï¼ŒåŒæ—¶æ”¶é›†æœ‰æ•ˆæ—¶é—´åšå¯¹æ¯”
4. å½“æœ‰æ•ˆæ—¶é—´åˆ°è¾¾æ—¶ï¼Œå†…å®¹è„šæœ¬ç›´æ¥åœ¨å½“å‰é¡µé¢æ’å…¥æç¤ºä¿¡æ¯

ï¼ˆè¿™é‡Œæ˜¯æœ‰æ›´å¥½çš„æµç¨‹è®¾è®¡ï¼Œæ¯”å¦‚ä½¿ç”¨ `chrome.storage` APIï¼Œä»…åšæ•™ç¨‹æ¼”ç¤ºä½¿ç”¨æ­¤æµç¨‹ï¼‰

## æ¡ˆä¾‹åˆ†äº«

### å¤©æ°”é¢„æŠ¥

åå°è„šæœ¬ä¸­è·å–å¤©æ°”ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ `chrome.action.setIcon` è®¾ç½®å›¾æ ‡

```js:sw.js
chrome.action.setIcon({
  path: getIconPath(alarm.name),
});
```

### éŸ³ä¹æ’­æ”¾å™¨

è¯¦æƒ…å¯è§[ã€Šå¦‚ä½•åœ¨æµè§ˆå™¨æ‰©å±•ç¨‹åºä¸­åˆ›å»ºéŸ³ä¹æ’­æ”¾å™¨ã€‹](/blog/music-player-in-extension)

1. åœ¨ service_worker ä¸­åˆ›å»º offsrceen document
2. åœ¨ offsrceen document ä¸­åˆ›å»º audio
3. ä½¿ç”¨ `chrome.runtime.onMessage` é€šä¿¡

### Input Completer

1. åˆ›å»º Content Script æ’å…¥äº¤äº’
2. ç”±äºåŒæºç­–ç•¥ï¼Œæ‰€æœ‰è¯·æ±‚ç”±æ’ä»¶çš„ Service Worker ä»£ç†

## ä½¿ç”¨å¼€å‘æ¡†æ¶ç®€åŒ–å¼€å‘æµç¨‹

### plasmo

https://www.plasmo.com/

### wxt

https://wxt.dev/
